---
// OmniLLMChat.astro
// Responsive AGI-powered chat for site co-creation
import { useState } from 'react';
---

<div class="omni-llm-chat glass-panel border-glow flex flex-col gap-4 p-6">
  <h2 class="text-lg font-semibold text-white">Omni LLM Chat</h2>
  <div id="chat-messages" class="flex-1 space-y-3 overflow-y-auto max-h-64 mb-2">
    <!-- Messages will be rendered here -->
  </div>
  <form id="chat-form" class="flex gap-2 mt-2">
    <input type="text" id="chat-input" class="flex-1 px-3 py-2 rounded bg-white/10 text-white/80 border border-white/20" placeholder="Describe a change, ask for a new feature..." autocomplete="off" />
    <button type="submit" class="px-4 py-2 rounded bg-purple-600 text-white font-bold hover:bg-purple-700 transition">Send</button>
  </form>
</div>

<script>
const messages = [
  { role: 'system', text: 'Welcome to the AGI-powered site builder. Describe your idea or request a change.' }
];
const chatMessages = document.getElementById('chat-messages');
const chatForm = document.getElementById('chat-form');
const chatInput = document.getElementById('chat-input');

function renderMessages() {
  chatMessages.innerHTML = '';
  messages.forEach(msg => {
    const div = document.createElement('div');
    div.className = `chat-msg chat-${msg.role}`;
    div.textContent = msg.text;
    chatMessages.appendChild(div);
  });
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

renderMessages();

chatForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const userText = chatInput.value.trim();
  if (!userText) return;
  messages.push({ role: 'user', text: userText });
  renderMessages();
  chatInput.value = '';

  // Real backend call to llm-api
  fetch('/api/llm-api', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: userText })
  })
    .then(res => res.json())
    .then(data => {
      messages.push({ role: 'agi', text: data.response });
      renderMessages();
      setTimeout(() => {
        messages.push({ role: 'system', text: 'Artifact created. Site updated as per your request.' });
        renderMessages();
      }, 1500);
    })
    .catch(() => {
      messages.push({ role: 'system', text: 'Error: Unable to process request.' });
      renderMessages();
    });
});
</script>

<style>
.omni-llm-chat { background: rgba(30, 30, 60, 0.85); border-radius: 1rem; }
.chat-msg { padding: 0.5em 1em; border-radius: 0.5em; margin-bottom: 0.25em; }
.chat-system { background: #7c3aed22; color: #ffd700; }
.chat-user { background: #222; color: #fff; text-align: right; }
.chat-agi { background: #ffd70022; color: #7c3aed; }
</style>
